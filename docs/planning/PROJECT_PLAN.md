# Lumi Assistant - 项目开发计划

## 项目概述
基于Flutter开发的智能语音助手客户端，采用渐进式开发方式，确保每个功能都经过充分验证。

### 技术栈
- **框架**: Flutter 3.16+
- **状态管理**: flutter_hooks + hooks_riverpod  
- **网络通信**: dio + web_socket_channel
- **架构模式**: 分层架构 + 声明式状态管理 + 组合式组件设计

### 后端服务
- **WebSocket**: ws://192.168.110.199:8000/
- **HTTP API**: http://192.168.110.199:8000/api
- **认证方式**: Bearer Token + Device-ID

**注意**：`192.168.110.199:8000` 是开发环境的IP地址，生产环境部署时需要调整为实际的服务器地址。

## 开发原则
1. **渐进式开发**: 每个里程碑独立完成和验证
2. **质量优先**: 先确保功能稳定再添加新特性  
3. **用户验证**: 每个里程碑都需要用户确认通过
4. **文档同步**: 开发过程和决策都要记录

## 第一阶段目标：文字聊天全流程打通

### 里程碑规划

#### 🎯 里程碑1：项目基础搭建
**预计时间**: 0.5天  
**开发内容**:
- 创建Flutter项目
- 配置基础依赖  
- 搭建项目目录结构
- 实现基础主题和样式

**验证标准**:
- [x] 项目能成功编译并运行
- [x] 显示一个简单的"Hello World"界面  
- [x] 热重载功能正常
- [x] 无编译错误和警告

---

#### 🎯 里程碑2：网络连接基础  
**预计时间**: 1天
**开发内容**:
- 实现WebSocket连接服务
- 添加连接状态显示
- 实现基础错误处理

**验证标准**:
- [ ] 能连接到后端WebSocket服务器
- [ ] 界面显示连接状态（已连接/未连接）
- [ ] 连接失败时显示错误信息
- [ ] 能发送Hello消息并收到响应

---

#### 🎯 里程碑3：Hello握手流程
**预计时间**: 0.5天
**开发内容**:
- 实现Hello消息发送
- 解析Hello响应  
- 保存session_id

**验证标准**:
- [ ] 连接成功后自动发送Hello消息
- [ ] 能正确解析服务器返回的Hello响应
- [ ] session_id被正确保存和显示
- [ ] 握手失败时显示具体错误

---

#### 🎯 里程碑4：基础UI框架
**预计时间**: 1天  
**开发内容**:
- 主界面布局
- 背景图片显示
- 基础信息面板（时间显示）
- 右下角按钮

**验证标准**:
- [ ] 界面布局正确，符合设计要求
- [ ] 背景图片正常显示
- [ ] 时间显示准确并实时更新  
- [ ] 右下角按钮位置和样式正确
- [ ] 在不同屏幕尺寸下显示正常

---

#### 🎯 里程碑5：聊天界面基础
**预计时间**: 1天
**开发内容**:
- 聊天弹窗组件
- 消息输入框
- 发送按钮
- 基础消息显示

**验证标准**:
- [ ] 点击右下角按钮能弹出聊天界面
- [ ] 输入框能正常输入文字
- [ ] 发送按钮响应点击事件
- [ ] 能在界面显示输入的消息
- [ ] 聊天界面能正常关闭

---

#### 🎯 里程碑6：文字消息发送
**预计时间**: 1天
**开发内容**:
- 实现chat消息发送
- 消息状态管理（发送中/已发送/失败）
- 发送失败重试机制

**验证标准**:
- [ ] 输入文字点击发送后，消息显示为"发送中"状态
- [ ] 消息成功发送后状态变为"已发送"
- [ ] 发送失败时显示"发送失败"并提供重试
- [ ] 网络异常时重试机制正常工作

---

#### 🎯 里程碑7：LLM响应处理
**预计时间**: 1天
**开发内容**:
- 接收并解析LLM响应消息
- 在聊天界面显示AI回复
- 处理流式响应（如果支持）

**验证标准**:
- [ ] 发送消息后能收到AI的回复
- [ ] AI回复正确显示在聊天界面
- [ ] 消息气泡样式区分用户和AI
- [ ] 长回复内容显示完整
- [ ] 响应时间合理

---

#### 🎯 里程碑8：错误处理完善
**预计时间**: 1天
**开发内容**:
- 完善各种错误场景处理
- 用户友好的错误提示
- 自动重连机制
- 离线状态处理

**验证标准**:
- [ ] 网络断开时显示合适的提示信息
- [ ] 服务器错误时显示具体错误原因
- [ ] 自动重连功能正常工作
- [ ] 离线状态下的用户体验良好

---

#### 🎯 里程碑9：本地存储和历史记录
**预计时间**: 1天
**开发内容**:
- 聊天记录本地存储
- 历史消息加载
- 存储清理机制

**验证标准**:
- [ ] 聊天记录能正确保存到本地
- [ ] 重启应用后历史记录正常加载
- [ ] 历史记录显示正确的时间顺序
- [ ] 存储空间使用合理

---

#### 🎯 里程碑10：性能优化和打包
**预计时间**: 1天
**开发内容**:
- 性能优化
- 内存泄漏检查
- 打包配置
- 最终测试

**验证标准**:
- [ ] 应用启动时间 < 3秒
- [ ] 内存使用稳定，无明显泄漏
- [ ] 长时间使用无卡顿现象
- [ ] APK大小合理
- [ ] 能正常安装和运行

## 验证流程规范

### 每个里程碑的验证流程
1. **开发完成** → 2. **自测验证** → 3. **提交验证** → 4. **用户确认** → 5. **进入下一里程碑**

### 自测验证检查清单
- [ ] 代码编译无错误无警告
- [ ] 核心功能按预期工作
- [ ] 界面显示正常
- [ ] 无明显性能问题
- [ ] 错误场景处理正确

### 用户验证检查清单
- [ ] 功能符合需求预期
- [ ] 用户体验流畅
- [ ] 无阻塞性问题
- [ ] 可以进入下一阶段开发

## 后续阶段规划

### 第二阶段：语音交互功能
- 录音权限管理
- 实时音频采集和发送
- TTS音频接收和播放
- 语音状态指示

### 第三阶段：图像分析功能
- 相机权限和集成
- 图片选择和处理
- 图像分析结果展示

### 第四阶段：Live2D动画集成
- Live2D模型加载
- 情感状态映射
- 动画性能优化

## 开发记录
- **创建时间**: 2025-07-08
- **当前阶段**: 第一阶段规划完成
- **下一步**: 开始里程碑1 - 项目基础搭建