# 🤖 Lumi Assistant 项目概览

> 智能语音助手Flutter客户端 - 打造你的专属贾维斯

## 🎯 项目愿景

Lumi Assistant致力于打造一个**现代化、高性能、多模态**的智能语音助手客户端，让用户能够通过自然的语音交互控制智能设备、获取信息、完成各种任务。项目采用最新的Flutter架构模式和AI技术，为用户提供流畅、智能的交互体验。

## ✨ 核心特性

### 🗣️ 智能语音交互
- **实时语音识别** (STT): 支持连续语音输入，实时转换为文字
- **自然语音合成** (TTS): 高质量语音输出，支持多种语音风格
- **语音打断功能**: 支持用户随时打断AI回复，实现自然对话流程
- **Opus音频编码**: 低延迟、高质量的音频传输

### 🤖 多模态AI能力
- **对话式AI**: 基于大语言模型的智能对话
- **图像理解**: 支持拍照识图、图像分析和描述
- **上下文记忆**: 维持对话上下文，提供连贯的交互体验
- **个性化响应**: 根据用户喜好调整回复风格

### 🏠 IoT设备控制
- **智能设备管理**: 通过MCP协议控制智能家居设备
- **语音设备控制**: 音量调节、设备开关等基础控制
- **场景自动化**: 支持复杂的设备控制场景
- **扩展性架构**: 轻松添加新的设备控制功能

### 📱 现代化UI设计
- **响应式布局**: 适配手机、平板、横屏设备等多种屏幕
- **Material Design 3**: 遵循最新的Material设计规范
- **悬浮式交互**: 支持悬浮聊天窗口，不干扰其他应用使用
- **主题定制**: 支持深色模式、字体缩放等个性化设置

## 🏗️ 技术架构

### 架构设计原则
- **Clean Architecture**: 清晰的分层架构，易于维护和扩展
- **响应式编程**: 基于Stream和Future的异步编程模型
- **组合优于继承**: 使用组合模式构建复杂功能
- **依赖注入**: 通过Riverpod实现松耦合的依赖管理

### 核心技术栈

#### Frontend (Flutter)
```
📱 Presentation Layer
├── Flutter 3.x                    # 最新Flutter版本
├── hooks_riverpod                 # 现代化状态管理
├── freezed                        # 不可变数据模型
├── flutter_hooks                  # 函数式组件开发
└── go_router                      # 声明式路由管理
```

#### Native Layer (Android/iOS)
```
🔧 Native Integration
├── Android AudioTrack             # Android原生音频播放
├── Opus Codec                     # 高质量音频编解码
├── MethodChannel                  # Flutter-Native通信
└── Platform Channels             # 平台特定功能调用
```

#### Backend Integration
```
🌐 Server Communication
├── WebSocket                      # 实时双向通信
├── HTTP API                       # RESTful接口调用
├── JSON-RPC                       # 结构化API调用
└── MCP Protocol                   # IoT设备控制协议
```

### 项目架构图

```
┌─────────────────────────────────────────────────────────────┐
│                    Lumi Assistant                           │
├─────────────────────────────────────────────────────────────┤
│  📱 Presentation Layer (Flutter UI)                        │
│    ├── 🏠 HomePage (主界面 + 虚拟角色)                       │
│    ├── 💬 ChatPage (聊天交互界面)                           │
│    ├── ⚙️ SettingsPage (应用设置)                          │
│    └── 🎛️ FloatingChat (悬浮式聊天)                        │
├─────────────────────────────────────────────────────────────┤
│  🔄 State Management (Riverpod Providers)                  │
│    ├── ConnectionProvider (连接状态管理)                    │
│    ├── ChatProvider (聊天消息管理)                         │
│    ├── AudioProvider (音频状态管理)                        │
│    └── SettingsProvider (配置管理)                         │
├─────────────────────────────────────────────────────────────┤
│  🛠️ Service Layer (核心业务逻辑)                            │
│    ├── 🌐 WebSocketService (实时通信)                       │
│    ├── 🎤 AudioService (音频处理)                          │
│    ├── 🤝 HandshakeService (连接握手)                       │
│    ├── 🏠 DeviceControlService (设备控制)                   │
│    └── 🔍 NetworkChecker (网络状态)                        │
├─────────────────────────────────────────────────────────────┤
│  🔧 Native Layer (Platform Integration)                    │
│    ├── 📢 Android AudioTrack (音频播放)                     │
│    ├── 🎙️ Audio Recording (录音功能)                       │
│    ├── 🔊 Opus Codec (音频编解码)                          │
│    └── 📱 Device Info (设备信息)                           │
└─────────────────────────────────────────────────────────────┘
                              ↕️ WebSocket + HTTP
┌─────────────────────────────────────────────────────────────┐
│               Python Backend Server                        │
│  🤖 AI Services | 🏠 IoT Control | 📡 Message Router       │
└─────────────────────────────────────────────────────────────┘
```

## 🚀 开发里程碑

项目采用**里程碑驱动开发**，确保每个阶段都有明确的目标和验收标准：

### ✅ 已完成里程碑

#### 里程碑1：项目基础搭建
- Flutter项目初始化和基础配置
- 目录结构设计和规范制定
- 开发环境配置和工具链搭建

#### 里程碑2：网络连接基础
- WebSocket连接框架搭建
- 基础网络错误处理
- 连接状态管理

#### 里程碑3：Hello握手流程
- 客户端-服务器握手协议实现
- 设备信息收集和传输
- 会话管理机制

#### 里程碑4：基础UI框架
- 响应式UI架构设计
- 主页面和基础组件实现
- Material Design 3主题配置

#### 里程碑5：聊天界面基础
- 聊天界面UI实现
- 消息显示和输入功能
- 基础动画和交互效果

#### 里程碑6：文字消息发送
- 文字消息发送功能
- 消息状态管理和显示
- WebSocket消息传输

### 🔄 当前开发阶段

#### 里程碑7：LLM响应处理 (进行中)
- [ ] 服务器响应消息接收
- [ ] AI回复内容解析和显示
- [ ] 消息流状态管理
- [ ] IoT工具调用结果处理
- [ ] 错误处理和重试机制

### 📋 未来里程碑规划

#### 里程碑8：音频录制功能
- Opus音频录制实现
- 录音权限管理
- 音频数据压缩和传输

#### 里程碑9：TTS播放功能
- TTS音频接收和解析
- 原生音频播放器集成
- 音频播放状态管理

#### 里程碑10：语音打断机制
- 实时语音打断检测
- 播放中断和恢复
- 自然对话流程实现

## 🔧 开发环境要求

### 基础环境
- **Flutter**: 3.19.0 或更高版本
- **Dart**: 3.3.0 或更高版本
- **Android Studio** / **VS Code** 与Flutter插件
- **Git**: 版本控制

### 推荐设备配置
- **主要测试设备**: YT3002 (Android 7.0, 1280x736横屏)
- **开发机器**: macOS/Linux/Windows with 8GB+ RAM
- **网络环境**: 局域网访问Python后端服务器

### 开发工具链
```bash
# Flutter环境检查
flutter doctor

# 项目依赖安装
flutter pub get

# 代码质量检查
flutter analyze

# 运行应用（推荐设备）
flutter run -d 1W11833968
```

## 📊 项目统计

### 代码规模 (预估)
- **Dart代码**: ~15,000 行
- **配置文件**: ~2,000 行
- **文档**: ~8,000 行
- **测试代码**: ~3,000 行

### 功能模块分布
- **UI界面**: ~40%
- **状态管理**: ~20%
- **服务层**: ~25%
- **原生集成**: ~10%
- **配置和工具**: ~5%

## 🎯 质量保证

### 代码质量
- **静态分析**: 使用`flutter analyze`进行代码质量检查
- **编码规范**: 遵循Dart官方编码规范
- **注释文档**: 详细的代码注释和API文档
- **类型安全**: 严格的类型检查和空安全

### 测试策略
- **单元测试**: 核心业务逻辑测试覆盖
- **Widget测试**: UI组件功能测试
- **集成测试**: 端到端功能流程测试
- **设备测试**: 多设备兼容性测试

### 性能优化
- **内存管理**: 及时释放资源，避免内存泄漏
- **渲染优化**: 减少不必要的Widget重建
- **网络优化**: 连接复用和超时处理
- **电池优化**: 合理使用系统资源

## 🤝 贡献指南

### 参与方式
1. **Bug修复**: 查看Issues列表，选择感兴趣的bug进行修复
2. **功能开发**: 参与新功能的设计和实现
3. **文档完善**: 改进技术文档和使用说明
4. **测试验证**: 在不同设备上测试应用功能
5. **性能优化**: 识别和解决性能瓶颈

### 开发流程
1. Fork项目并创建功能分支
2. 按照编码规范进行开发
3. 添加必要的测试和文档
4. 提交Pull Request并等待代码审查
5. 根据反馈进行修改和完善

### 社区支持
- **GitHub Issues**: 报告bug和提出功能请求
- **GitHub Discussions**: 技术讨论和经验分享
- **Code Review**: 互相审查代码，提升质量
- **文档贡献**: 完善项目文档和教程

## 📜 开源协议

本项目采用 [MIT License](../LICENSE) 开源协议，欢迎个人和商业使用。

## 📞 联系方式

- **项目主页**: [GitHub仓库链接]
- **问题反馈**: [GitHub Issues]
- **技术讨论**: [GitHub Discussions]
- **文档中心**: [docs目录]

---

> 🌟 **愿景**: 让每个人都能拥有自己的智能语音助手
> 
> 🚀 **使命**: 通过开源协作，打造最好的Flutter AI应用
> 
> 💡 **价值观**: 开放、协作、创新、用户第一

**欢迎加入Lumi Assistant开发团队，一起打造未来的智能交互体验！**