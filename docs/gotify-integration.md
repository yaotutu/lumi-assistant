# Gotify 集成指南

## 概述

Lumi Assistant 已集成 Gotify 推送通知服务，可以接收来自 Gotify 服务器的实时通知并在应用内显示。

## 快速开始

### 1. 配置 Gotify 服务器信息

有两种配置方式：

#### 方式一：通过应用设置页面配置（推荐）

1. 打开应用设置页面
2. 点击 "Gotify 通知配置"
3. 输入您的 Gotify 服务器地址（例如：`http://192.168.1.100:8080`）
4. 输入您的客户端令牌
5. 点击 "测试连接" 验证配置
6. 启用 Gotify 服务

#### 方式二：临时硬编码配置（仅用于测试）

如果您暂时无法使用设置页面，可以编辑文件 `lib/core/services/gotify_service.dart`：

```dart
// 在文件开头添加临时配置
static const String _tempServerUrl = 'http://your-gotify-server.com';
static const String _tempClientToken = 'your-client-token-here';

// 然后修改相应的方法使用这些临时值
```

### 2. 获取 Gotify 客户端令牌

1. 登录你的 Gotify 服务器
2. 进入 "Clients" 页面
3. 创建新的客户端或使用现有客户端
4. 复制客户端令牌

### 3. 测试集成

1. 打开应用设置页面
2. 进入 "Gotify 通知测试"
3. 启用 Gotify 服务
4. 发送测试通知验证功能

## 功能特点

- **实时通知**：通过 WebSocket 接收实时推送
- **自动重连**：网络断开后自动恢复连接
- **历史消息**：启动时获取最近的未读消息
- **优先级映射**：Gotify 优先级自动映射到应用内通知级别
- **通知管理**：集成到统一的通知气泡系统

## 通知级别映射

| Gotify 优先级 | 应用内级别 | 说明 |
|--------------|------------|------|
| 0-2 | 低 (low) | 一般信息 |
| 3-5 | 普通 (normal) | 常规通知 |
| 6-7 | 高 (high) | 重要通知 |
| 8-10 | 紧急 (urgent) | 紧急事件 |

## 后续计划

1. **设置页面集成**：将服务器配置迁移到设置页面
2. **多服务器支持**：支持连接多个 Gotify 服务器
3. **通知过滤**：根据应用、优先级等过滤通知
4. **持久化存储**：保存已读/未读状态

## 故障排除

### 无法连接到服务器

1. 检查服务器地址是否正确
2. 确认客户端令牌有效
3. 检查网络连接和防火墙设置

### 收不到通知

1. 确认 Gotify 服务已启用
2. 检查 WebSocket 连接状态
3. 查看应用日志中的错误信息

### 通知显示异常

1. 确认通知气泡已正确初始化
2. 检查通知级别映射是否正确
3. 验证消息格式是否符合预期